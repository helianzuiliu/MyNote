### RDB(Redis Database)持久化

Redis会单独创建一个子进程进行持久化,先将数据写入到一个临时文件中,等持久化过程结束后再用零售及文件替换上次持久化的文件,这个过程中主进程不涉及IO操作,所以不会影响Redis本体的速度

如果需要进行大规模数据的恢复,且对于数据恢复的完整性不是非常敏感,那RDB方式比AOF方式更加高效

优点:

- 高效
- 适合大规模的数据恢复
- 对数据完整性要求不高
缺点:
- 需要一定的时间间隔进行操作
- 如果宕机了最后一次持久化的数据就没了
- fork进程的时候会占用一定的内存空间

触发规则

1. config文件中的save规则满足
2. 执行flushall命令
3. 退出redis-server会默认产生

### AOF(Append Only File)持久化

以日志的形式将所有命令记录下来(只记录写操作不记录都操作),恢复的时候将所有的命令再执行一遍

这个文件如果被恶意破坏且没有其他备份,则redis会无法启动,可以使用`redis-check-aof --fix` 进行修复(把被恶意破坏的数据直接删掉)

默认不开启

```txt
appendonly no # aof的开关

auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb # aof文件大于64mb会追加一个文件写文件
```

![[Pasted image 20240603110536.png]]

优点

- 每一次修改都会同步,数据的完整性会更好
- 默认每秒同步一次
- 从不同步,效率最高

缺点

- 相对来说aof的数据文件比rdb大很多,修复速度也比rdb慢很多
- aof的运行会频繁涉及IO操作,速度比rdb慢

